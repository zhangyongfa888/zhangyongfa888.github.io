<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
	<script type="text/javascript" src="/js/love.js"></script>
	<script type="text/javascript" src="/js/baiduziyuan.js"></script>

    

    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?6e8ed41c9b3e5150dfe169447c30ea4d"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    
    
    
    <title>小程序云函数初体验 | WE ARE YOUNG | So let&#39;s set the world on fire</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="小程序">
    <meta name="description" content="无服务器（Serverless）计算是什么                                                                                             paste image              云计算涌现出很多改变传统IT架构和运维方式的新技术，比如虚拟机、容器、微服务，无论这些技术应用在哪些场景，降低成本、提升效">
<meta name="keywords" content="小程序">
<meta property="og:type" content="article">
<meta property="og:title" content="小程序云函数初体验">
<meta property="og:url" content="http://zhangyongfa888.site/2019/12/23/小程序云函数初体验/index.html">
<meta property="og:site_name" content="WE ARE YOUNG">
<meta property="og:description" content="无服务器（Serverless）计算是什么                                                                                             paste image              云计算涌现出很多改变传统IT架构和运维方式的新技术，比如虚拟机、容器、微服务，无论这些技术应用在哪些场景，降低成本、提升效">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://res.zhangyongfa888.site/1577091391371my9dpavz.png?imageslim">
<meta property="og:image" content="http://res.zhangyongfa888.site/1577091824160yqz0w36s.png?imageslim">
<meta property="og:image" content="http://res.zhangyongfa888.site/1577092418546xhvdiww2.png?imageslim">
<meta property="og:image" content="http://res.zhangyongfa888.site/15770926048817fjbf1zj.png?imageslim">
<meta property="og:updated_time" content="2020-03-10T05:53:48.759Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小程序云函数初体验">
<meta name="twitter:description" content="无服务器（Serverless）计算是什么                                                                                             paste image              云计算涌现出很多改变传统IT架构和运维方式的新技术，比如虚拟机、容器、微服务，无论这些技术应用在哪些场景，降低成本、提升效">
<meta name="twitter:image" content="http://res.zhangyongfa888.site/1577091391371my9dpavz.png?imageslim">
    
        <link rel="alternate" type="application/atom+xml" title="WE ARE YOUNG" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">zhangyongfa</h5>
          <a href="mailto:1399142039@qq.com" title="1399142039@qq.com" class="mail">1399142039@qq.com</a>
        </hgroup>
      </div>
	
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                全部
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zhangyongfa888" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.facebook.com/profile.php?id=100010579066716" target="_blank" >
                <i class="icon icon-lg icon-facebook"></i>
                Facebook
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://twitter.com/zhangyongfa888" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://t.me/joinchat/AAAAAEJricBW17-dsZbqew" target="_blank" >
                <i class="icon icon-lg icon-telegram"></i>
                Telegram
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://weibo.com/u/7125015766" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/share" target="_blank" >
                <i class="icon icon-lg icon-music"></i>
                日常
              </a>
            </li>
        
      </ul>
    </div>
	
	
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">小程序云函数初体验</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">小程序云函数初体验</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-12-23T08:51:00.000Z" itemprop="datePublished" class="page-time">
  2019-12-23
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Serverless/">Serverless</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Serverless/Telegram/">Telegram</a></li></ul></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
<aside class="post-widget">
    <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
        <h4>TOC</h4>
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#无服务器（Serverless）计算是什么"><span class="post-toc-number">1.</span> <span class="post-toc-text">无服务器（Serverless）计算是什么</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#理解Serverless技术—FaaS和BaaS"><span class="post-toc-number">2.</span> <span class="post-toc-text">理解Serverless技术—FaaS和BaaS</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#FaaS（Function-as-a-Service，函数即服务）"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">FaaS（Function as a Service，函数即服务）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#BaaS（Backend-as-a-Service，后端即服务）"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">BaaS（Backend as a Service，后端即服务）</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#无服务器（Serverless）计算如何工作？"><span class="post-toc-number">3.</span> <span class="post-toc-text">无服务器（Serverless）计算如何工作？</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#无服务器（Serverless）适用于哪些场景？"><span class="post-toc-number">4.</span> <span class="post-toc-text">无服务器（Serverless）适用于哪些场景？</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#场景一：应用负载有显著的波峰波谷"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">场景一：应用负载有显著的波峰波谷</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#场景二：典型用例-基于事件的数据处理"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">场景二：典型用例 - 基于事件的数据处理</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Serverless-的问题"><span class="post-toc-number">5.</span> <span class="post-toc-text">Serverless 的问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#不适合长时间运行应用"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">不适合长时间运行应用</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#完全依赖于第三方服务"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">完全依赖于第三方服务</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#缺乏调试和开发工具"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">缺乏调试和开发工具</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#构建复杂"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">构建复杂</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#总结"><span class="post-toc-number">6.</span> <span class="post-toc-text">总结</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实践"><span class="post-toc-number">7.</span> <span class="post-toc-text">实践</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#小程序云函数"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">小程序云函数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#leanClound云函数"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">leanClound云函数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#谷歌云函数"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">谷歌云函数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#谷歌脚本服务"><span class="post-toc-number">7.4.</span> <span class="post-toc-text">谷歌脚本服务</span></a></li></ol></li></ol>
        
        <h4 class="post-nav">友情链接</h4>

        
           <a class="post-toc-child" style="margin-left:20px" target="view_window" href="http://www.zhaixiaoou.com/">zhaixiaoou-小锡兵鸥</a>
           <br> <br>
        



    </nav>
</aside>



<article id="post-小程序云函数初体验"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">小程序云函数初体验</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-12-23 16:51:00" datetime="2019-12-23T08:51:00.000Z"  itemprop="datePublished">2019-12-23</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Serverless/">Serverless</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Serverless/Telegram/">Telegram</a></li></ul></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="无服务器（Serverless）计算是什么"><a href="#无服务器（Serverless）计算是什么" class="headerlink" title="无服务器（Serverless）计算是什么"></a>无服务器（Serverless）计算是什么</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://res.zhangyongfa888.site/1577091391371my9dpavz.png?imageslim" alt="paste image" title>
                </div>
                <div class="image-caption">paste image</div>
            </figure>
<p>云计算涌现出很多改变传统IT架构和运维方式的新技术，比如虚拟机、容器、微服务，无论这些技术应用在哪些场景，降低成本、提升效率是云服务永恒的主题。</p>
<p>过去十年来，我们已经把应用和环境中很多通用的部分变成了服务。Serverless的出现，带来了跨越式变革。Serverless把主机管理、操作系统管理、资源分配、扩容，甚至是应用逻辑的全部组件都外包出去，把它们看作某种形式的商品——厂商提供服务，我们掏钱购买。</p>
<p>过去是“构建一个框架运行在一台服务器上，对多个事件进行响应”，Serverless则变为“构建或使用一个微服务或微功能来响应一个事件”，做到当访问时，调入相关资源开始运行，运行完成后，卸载所有开销，真正做到按需按次计费。这是云计算向纵深发展的一种自然而然的过程。</p>
<p>Serverless是一种构建和管理基于微服务架构的完整流程，允许你在服务部署级别而不是服务器部署级别来管理你的应用部署。它与传统架构的不同之处在于，完全由第三方管理，由事件触发，存在于无状态（Stateless）、暂存（可能只存在于一次调用的过程中）计算容器内。构建无服务器应用程序意味着开发者可以专注在产品代码上，而无须管理和操作云端或本地的服务器或运行时。Serverless真正做到了部署应用无需涉及基础设施的建设，自动构建、部署和启动服务。</p>
<p>国内外的各大云厂商 Amazon、微软、Google、IBM、阿里云、腾讯云、华为云相继推出Serverless产品，Serverless也从概念、愿景逐步走向落地，在各企业、公司应用开来。</p>
<h3 id="理解Serverless技术—FaaS和BaaS"><a href="#理解Serverless技术—FaaS和BaaS" class="headerlink" title="理解Serverless技术—FaaS和BaaS"></a>理解Serverless技术—FaaS和BaaS</h3><p>Serverless由开发者实现的服务端逻辑运行在无状态的计算容器中，它由事件触发， 完全被第三方管理，其业务层面的状态则被开发者使用的数据库和存储资源所记录。Serverless涵盖了很多技术，分为两类：FaaS和BaaS。</p>
<h4 id="FaaS（Function-as-a-Service，函数即服务）"><a href="#FaaS（Function-as-a-Service，函数即服务）" class="headerlink" title="FaaS（Function as a Service，函数即服务）"></a>FaaS（Function as a Service，函数即服务）</h4><p>FaaS意在无须自行管理服务器系统或自己的服务器应用程序，即可直接运行后端代码。其中所指的服务器应用程序，是该技术与容器和PaaS（平台即服务）等其他现代化架构最大的差异。</p>
<p>FaaS可以取代一些服务处理服务器（可能是物理计算机，但绝对需要运行某种应用程序），这样不仅不需要自行供应服务器，也不需要全时运行应用程序。</p>
<p>FaaS产品不要求必须使用特定框架或库进行开发。在语言和环境方面，FaaS函数就是常规的应用程序。例如AWS Lambda的函数可以通过Javascript、Python以及任何JVM语言（Java、Clojure、Scala）等实现。然而Lambda函数也可以执行任何捆绑有所需部署构件的进程，因此可以使用任何语言，只要能编译为Unix进程即可。FaaS函数在架构方面确实存在一定的局限，尤其是在状态和执行时间方面。</p>
<p>在迁往FaaS的过程中，唯一需要修改的代码是“主方法/启动”代码，其中可能需要删除顶级消息处理程序的相关代码（“消息监听器接口”的实现），但这可能只需要更改方法签名即可。在FaaS的世界中，代码的其余所有部分（例如向数据库执行写入的代码）无须任何变化。</p>
<p>相比传统系统，部署方法会有较大变化 – 将代码上传至FaaS供应商，其他事情均可由供应商完成。目前这种方式通常意味着需要上传代码的全新定义（例如上传zip或JAR文件），随后调用一个专有API发起更新过程。</p>
<p>FaaS中的函数可以通过供应商定义的事件类型触发。对于亚马逊AWS，此类触发事件可以包括S3（文件）更新、时间（计划任务），以及加入消息总线的消息（例如Kinesis）。通常你的函数需要通过参数指定自己需要绑定到的事件源。</p>
<p>大部分供应商还允许函数作为对传入Http请求的响应来触发，通常这类请求来自某种该类型的API网关（例如AWS API网关、Webtask）。</p>
<h4 id="BaaS（Backend-as-a-Service，后端即服务）"><a href="#BaaS（Backend-as-a-Service，后端即服务）" class="headerlink" title="BaaS（Backend as a Service，后端即服务）"></a>BaaS（Backend as a Service，后端即服务）</h4><p>BaaS（Backend as a Service，后端即服务）是指我们不再编写或管理所有服务端组件，可以使用领域通用的远程组件（而不是进程内的库）来提供服务。理解BaaS，需要搞清楚它与PaaS的区别。</p>
<p>首先BaaS并非PaaS，它们的区别在于：PaaS需要参与应用的生命周期管理，BaaS则仅仅提供应用依赖的第三方服务。典型的PaaS平台需要提供手段让开发者部署和配置应用，例如自动将应用部署到Tomcat容器中，并管理应用的生命周期。BaaS不包含这些内容，BaaS只以API的方式提供应用依赖的后端服务，例如数据库和对象存储。BaaS可以是公共云服务商提供的，也可以是第三方厂商提供的。其次从功能上讲，BaaS可以看作PaaS的一个子集，即提供第三方依赖组件的部分。</p>
<p>BaaS服务还允许我们依赖其他人已经实现的应用逻辑。对于这点，认证就是一个很好的例子。很多应用都要自己编写实现注册、登录、密码管理等逻辑的代码，而对于不同的应用这些代码往往大同小异。完全可以把这些重复性的工作提取出来，再做成外部服务，而这正是Auth0和Amazon Cognito等产品的目标。它们能实现全面的认证和用户管理，开发团队再也不用自己编写或者管理实现这些功能的代码。</p>
<h3 id="无服务器（Serverless）计算如何工作？"><a href="#无服务器（Serverless）计算如何工作？" class="headerlink" title="无服务器（Serverless）计算如何工作？"></a>无服务器（Serverless）计算如何工作？</h3><p>与使用虚拟机或一些底层的技术来部署和管理应用程序相比，无服务器计算提供了一种更高级别的抽象。因为它们有不同的抽象和“触发器”的集合。</p>
<p>拿计算来讲，这种抽象有一个特定函数和抽象的触发器，它通常是一个事件。以数据库为例，这种抽象也许是一个表，而触发器相当于表的查询或搜索，或者通过在表中做一些事情而生成的事件。</p>
<p>比如一款手机游戏，允许用户在不同的平台上为全球顶级玩家使用高分数表。当请求此信息时，请求从应用程序到API接口。API接口或许会触发AWS的Lambda函数，或者无服务器函数，这些函数再从数据库表中获取到数据流，返回包含前五名分数的一定格式的数据。</p>
<p>一旦构建完成，应用程序的功能就可以在基于移动和基于 Web 的游戏版本中重用。</p>
<p>这跟设置服务器不同，不是必须要有Amazon EC2实例或服务器，然后等待请求。环境由事件触发，而响应事件所需的逻辑只在响应时执行。这意味着，运行函数的资源只有在函数运行时被创建，产生一种非常高效的方法来构建应用程序。</p>
<h3 id="无服务器（Serverless）适用于哪些场景？"><a href="#无服务器（Serverless）适用于哪些场景？" class="headerlink" title="无服务器（Serverless）适用于哪些场景？"></a>无服务器（Serverless）适用于哪些场景？</h3><p>serverless<br>在现阶段，Serverless主要应用在以下几个场景。首先在Web及移动端服务中，可以整合API网关和Serverles服务构建Web及移动后端，帮助开发者构建可弹性扩展、高可用的移动或 Web后端应用服务。在IoT场景下可高效的处理实时流数据，由设备产生海量的实时信息流数据，通过Serverles服务分类处理并写入后端处理。另外在实时媒体资讯内容处理场景里，用户上传的音视频到对象存储OBS，通过上传事件触发多个函数，分别完成高清转码、音频转码等功能，满足用户对实时性和并发能力的高要求。无服务器计算还适合于任何事件驱动的各种不同的用例，这包括物联网，移动应用，基于网络的应用程序和聊天机器人等。这里简单说两个场景，方便大家思考。</p>
<h4 id="场景一：应用负载有显著的波峰波谷"><a href="#场景一：应用负载有显著的波峰波谷" class="headerlink" title="场景一：应用负载有显著的波峰波谷"></a>场景一：应用负载有显著的波峰波谷</h4><p>Serverless 应用成功与否的评判标准并不是公司规模的大小，而是其业务背后的具体技术问题，比如业务波峰波谷明显，如何实现削峰填谷。一个公司的业务负载具有波峰波谷时，机器资源要按照峰值需求预估；而在波谷时期机器利用率则明显下降，因为不能进行资源复用而导致浪费。</p>
<p>业界普遍共识是，当自有机器的利用率小于 30%，使用 Serverless 后会有显著的效率提升。对于云服务厂商，在具备了足够多的用户之后，各种波峰波谷叠加后平稳化，聚合之后资源复用性更高。比如，外卖企业负载高峰是在用餐时期，安防行业的负载高峰则是夜间，这是受各个企业业务定位所限的；而对于一个成熟的云服务厂商，如果其平台足够大，用户足够多，是不应该有明显的波峰波谷现象的。</p>
<h4 id="场景二：典型用例-基于事件的数据处理"><a href="#场景二：典型用例-基于事件的数据处理" class="headerlink" title="场景二：典型用例 - 基于事件的数据处理"></a>场景二：典型用例 - 基于事件的数据处理</h4><p>视频处理的后端系统，常见功能需求如下：视频转码、抽取数据、人脸识别等，这些均为通用计算任务，可由函数计算执行。</p>
<p>开发者需要自己写出实现逻辑，再将任务按照控制流连接起来，每个任务的具体执行由云厂商来负责。如此，开发变得更便捷，并且构建的系统天然高可用、实时弹性伸缩，用户不需要关心机器层面问题。</p>
<h3 id="Serverless-的问题"><a href="#Serverless-的问题" class="headerlink" title="Serverless 的问题"></a>Serverless 的问题</h3><p>对于企业来说，支持Serverless计算的平台可以节省大量时间和成本，同时可以释放员工，让开发者得以开展更有价值的工作，而不是管理基础设施。另一方面可以提高敏捷度，更快速地推出新应用和新服务，进而提高客户满意度。但是Serverless不是完美的，它也存在一些问题，需要慎重应用在生产环境。</p>
<h4 id="不适合长时间运行应用"><a href="#不适合长时间运行应用" class="headerlink" title="不适合长时间运行应用"></a>不适合长时间运行应用</h4><p>Serverless 在请求到来时才运行。这意味着，当应用不运行的时候就会进入 “休眠状态”，下次当请求来临时，应用将会需要一个启动时间，即冷启动时间。如果你的应用需要一直长期不间断的运行、处理大量的请求，那么你可能就不适合采用 Serverless 架构。如果你通过 CRON 的方式或者 CloudWatch 来定期唤醒应用，又会比较消耗资源。这就需要我们对它做优化，如果频繁调用，这个资源将会常驻内存，第一次冷启之后，就可以一直服务，直到一段时间内没有新的调用请求进来，则会转入“休眠”状态，甚至被回收，从而不消耗任何资源。</p>
<h4 id="完全依赖于第三方服务"><a href="#完全依赖于第三方服务" class="headerlink" title="完全依赖于第三方服务"></a>完全依赖于第三方服务</h4><p>当你所在的企业云环境已经有大量的基础设施的时候，Serverless 对于你来说，并不是一个好东西。当我们采用某云服务厂商的 Serverless 架构时，我们就和该服务供应商绑定了，那么我们再将服务迁到别的云服务商上就没有那么容易了。</p>
<p>我们需要修改一下系列的底层代码，能采取的应对方案，便是建立隔离层。这意味着，在设计应用的时候，就需要隔离 API 网关、隔离数据库层，考虑到市面上还没有成熟的 ORM 工具，让你既支持Firebase，又支持 DynamoDB等等。这些也将带给我们一些额外的成本，可能带来的问题会比解决的问题多。</p>
<h4 id="缺乏调试和开发工具"><a href="#缺乏调试和开发工具" class="headerlink" title="缺乏调试和开发工具"></a>缺乏调试和开发工具</h4><p>当我使用 Serverless Framework 的时候，遇到了这样的问题：缺乏调试和开发工具。后来，我发现了 serverless-offline、dynamodb-local 等一系列插件之后，问题有一些改善。然而，对于日志系统来说，这仍然是一个艰巨的挑战。</p>
<p>每次你调试的时候，你需要一遍又一遍地上传代码。而每次上传的时候，你就好像是在部署服务器，并不能总是快速地定位出问题在哪。后来，找了一个类似于 log4j 这样的可以分级别记录日志的 Node.js 库 winston。它可以支持 error、warn、info、verbose、debug、silly 六个不同级别的日志，再结合大数据进行日志分析过滤，才能快速定位问题。</p>
<h4 id="构建复杂"><a href="#构建复杂" class="headerlink" title="构建复杂"></a>构建复杂</h4><p>Serverless 很便宜，但是这并不意味着它很简单。AWS Lambda的 CloudFormation配置是如此的复杂，并且难以阅读及编写（JSON 格式），虽然CloudFomation提供了Template模板，但想要使用它的话，需要创建一个Stack，在Stack中指定你要使用的Template,然后aws才会按照Template中的定义来创建及初始化资源。</p>
<p>而Serverless Framework的配置更加简单，采用的是 YAML 格式。在部署的时候，Serverless Framework 会根据我们的配置生成 CloudFormation 配置。然而这也并非是一个真正用于生产的配置,真实的应用场景远远比这复杂。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>云计算经过这么多年的发展，逐渐进化到用户仅需关注业务和所需的资源。比如，通过K8S这类编排工具，用户只要关注自己的计算和需要的资源（CPU、内存等）就行了，不需要操心到机器这一层。</p>
<p>Serverless架构让人们不再操心运行所需的资源，只需关注自己的业务逻辑，并且为实际消耗的资源付费。可以说，随着Serverless架构的兴起，真正的云计算时代才算到来了。</p>
<p>任何新概念新技术的落地，本质上都是要和具体业务去结合，去真正解决具体问题。虽然Serverless很多地方不成熟，亟待完善。不过Serverless自身的优越特性，对于开发者来说，吸引力是巨大的。相信随着技术的飞速发展，Serverless在未来还有无限可能！</p>
<p>以上转自<a href="https://blog.csdn.net/cc18868876837/article/details/90672971" target="_blank" rel="noopener">https://blog.csdn.net/cc18868876837/article/details/90672971</a></p>
<h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><p>目前接触到的云函数有 小程序 云函数、leanClound 、Google Cloud Function等。</p>
<h4 id="小程序云函数"><a href="#小程序云函数" class="headerlink" title="小程序云函数"></a>小程序云函数</h4><p>新建小程序 勾选云函数选项，即可使用。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://res.zhangyongfa888.site/1577091824160yqz0w36s.png?imageslim" alt="新建" title>
                </div>
                <div class="image-caption">新建</div>
            </figure>
<p>右键新建函数比如getAllRecord。新建后，在云开发中的数据库中新建表后才能获取到。然后编写代码，比如获取所有数据</p>
<pre><code>// 先取出集合记录总数
const countResult = await db.collection(&apos;recordlist&apos;).count()
const total = countResult.total
// 计算需分几次取
const batchTimes = Math.ceil(total / 100)
// 承载所有读操作的 promise 的数组
const tasks = []
for (let i = 0; i &lt; batchTimes; i++) {
  const promise = db.collection(&apos;recordlist&apos;).skip(i * MAX_LIMIT).limit(MAX_LIMIT).get()
  tasks.push(promise)
}
// 等待所有
return (await Promise.all(tasks)).reduce((acc, cur) =&gt; {
  return {
    data: acc.data.concat(cur.data),
    errMsg: acc.errMsg
  }
})</code></pre><p>添加记录</p>
<pre><code>db.collection(&quot;recordlist&quot;).add({
  data: {
    &quot;money&quot;: event.money,
    &quot;title&quot;: event.title
  },

}).then(
  res =&gt; {
    return res;
  }
)</code></pre><p> 小程序调用添加一条记录</p>
<pre><code> wx.cloud.callFunction({
  name: &apos;getAllRecord&apos;,
  data: {
    &quot;method&quot;: &quot;add&quot;,
    &quot;title&quot;: that.data.array[that.data.index],
    &quot;money&quot;: that.data.inputStr
  },
  success: res =&gt; {
    console.log(&apos;[云函数] [addOne] res &apos;, res)
    that.getData(that);
    that.setData({
      hiddenAddModal: true
    })

  },
  fail: err =&gt; {
    console.error(&apos;[云函数] [addOne] 调用失败&apos;, err)

  }
})</code></pre><p>  小程序获取所有记录</p>
<pre><code>  wx.cloud.callFunction({
  name: &apos;getAllRecord&apos;,
  data: {
    &quot;method&quot;: &quot;all&quot;
  },
  success: res =&gt; {
    console.log(&apos;[云函数] [getAllRecord] res &apos;, res)
    that.setData({
      moneyList: res.result.data
    })

  },
  fail: err =&gt; {
    console.error(&apos;[云函数] [getAllRecord] 调用失败&apos;, err)

  }
})</code></pre><h4 id="leanClound云函数"><a href="#leanClound云函数" class="headerlink" title="leanClound云函数"></a><a href="https://www.leancloud.cn/" target="_blank" rel="noopener">leanClound云函数</a></h4><p>leanClound接触比较早的但是从来没有用过的。至少，本博客接入的评论valine使用的是leanClound的服务。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://res.zhangyongfa888.site/1577092418546xhvdiww2.png?imageslim" alt="云数据库中的数据" title>
                </div>
                <div class="image-caption">云数据库中的数据</div>
            </figure>


<h4 id="谷歌云函数"><a href="#谷歌云函数" class="headerlink" title="谷歌云函数"></a><a href="https://cloud.google.com/functions/" target="_blank" rel="noopener">谷歌云函数</a></h4><pre><code>Google Cloud Functions 是一款基于事件的轻量级异步计算解决方案，可帮助您构建单一用途的小函数，用于在无需管理服务器或运行时环境的情况下就能对云端事件做出响应。
现在注册 免费获得 $300 赠金
注册即可获得 $300 赠金，未来 12 个月内可在 Google Cloud Platform 上随心使用。</code></pre><h4 id="谷歌脚本服务"><a href="#谷歌脚本服务" class="headerlink" title="谷歌脚本服务"></a>谷歌脚本服务</h4><p>谷歌云函数由于墙的原因，国内很少用。谷歌脚本服务在TG上实现：</p>
<pre><code>function preparePayload(body) {
var payload;
if (body.message.text) { //接收到文本 
  var restText = body.message.text;
  if (restText.indexOf(&quot;名字&quot;) &gt;= 0) {
    restText = &quot;我叫多多~&quot;;
  }
  //消息体
  payload = {
    &quot;method&quot;: &quot;sendMessage&quot;,
    &quot;chat_id&quot;: body.message.chat.id,
    &quot;text&quot;: restText,
  }

} else if (body.message.sticker) { //接收到表情 直接返回表情
  payload = {
    &quot;method&quot;: &quot;sendSticker&quot;,
    &quot;chat_id&quot;: body.message.chat.id,
    &quot;sticker&quot;: body.message.sticker.file_id
  }
} else if (body.message.photo) { //接收到图片，直接返回图片
  array = body.message.photo;
  text = array[1];
  payload = {
    &quot;method&quot;: &quot;sendPhoto&quot;,
    &quot;chat_id&quot;: body.message.chat.id,
    &quot;photo&quot;: text.file_id
  }
} else {
  payload = {
    &quot;method&quot;: &quot;sendMessage&quot;,
    &quot;chat_id&quot;: body.message.chat.id,
    &quot;text&quot;: &quot; 对不起，无法识别内容！！&quot;
  }
}
return payload
  }</code></pre><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://res.zhangyongfa888.site/15770926048817fjbf1zj.png?imageslim" alt="多多机器人" title>
                </div>
                <div class="image-caption">多多机器人</div>
            </figure>
<p>这里自动回复的是输入什么回复什么，匹配到关键字后回复指定字符或者媒体资源。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-03-10T05:53:48.759Z" itemprop="dateUpdated">2020-03-10 13:53:48</time>
</span><br>


        
        (侵删)转载注明链接：<a href="/2019/12/23/小程序云函数初体验/" target="_blank" rel="external">http://zhangyongfa888.site/2019/12/23/小程序云函数初体验/</a>
        
    </div>
    
    <footer>
        <a href="http://zhangyongfa888.site">
            <img src="/img/avatar.jpg" alt="zhangyongfa">
            zhangyongfa
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/小程序/">小程序</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://zhangyongfa888.site/2019/12/23/小程序云函数初体验/&title=《小程序云函数初体验》 — WE ARE YOUNG&pic=http://zhangyongfa888.site/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://zhangyongfa888.site/2019/12/23/小程序云函数初体验/&title=《小程序云函数初体验》 — WE ARE YOUNG&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://zhangyongfa888.site/2019/12/23/小程序云函数初体验/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《小程序云函数初体验》 — WE ARE YOUNG&url=http://zhangyongfa888.site/2019/12/23/小程序云函数初体验/&via=http://zhangyongfa888.site" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://zhangyongfa888.site/2019/12/23/小程序云函数初体验/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/01/19/一个简单的进度条实现/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">一个简单的进度条实现</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/12/20/对一点英语进行破解（xp模块）/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">对一点英语进行破解（xp模块）</h4>
      </a>
    </div>
  
</nav>



    









 <a>0.09683157895386585 <a> 


<div>
 <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=100%
  src="//music.163.com/outchain/player?type=2&id=1449871979&auto=1&height=86">
  </iframe>          
</div>
















    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "PWpkfff1WSoRsr13I9f2WfH3-gzGzoHsz",
            appKey: "x4tMCz9Cs2iUuXk3vFpr97E1",
            avatar: "monsterid",
            placeholder: "Just go go",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->











	
</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <!-- 
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span> </span> -->
            <br>
            <p id="hitokoto" >:D 获取中...</p>

        </p>

    </div>
    <div class="bottom">
        <p><span>zhangyongfa &copy; 2018 - 2020</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">冀ICP备17033377号</a><br>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://zhangyongfa888.site/2019/12/23/小程序云函数初体验/&title=《小程序云函数初体验》 — WE ARE YOUNG&pic=http://zhangyongfa888.site/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://zhangyongfa888.site/2019/12/23/小程序云函数初体验/&title=《小程序云函数初体验》 — WE ARE YOUNG&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://zhangyongfa888.site/2019/12/23/小程序云函数初体验/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《小程序云函数初体验》 — WE ARE YOUNG&url=http://zhangyongfa888.site/2019/12/23/小程序云函数初体验/&via=http://zhangyongfa888.site" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://zhangyongfa888.site/2019/12/23/小程序云函数初体验/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtElEQVR42u3a227CMBAFQP7/p6nUp0qUcPZiSqXJE0oI8bhSvD3e2y0+7t/Hz8/XZx7vfbx6f3IkV5cPPDw8vNbQqw9L2MkTk6s5/pffxMPDwzvGyxeDHu96EM9+c/IdPDw8vE/g5S/6fGqSScHDw8P777w8FEgWgOrSgoeHh/c5vCSM6C0YyVJRjXGPZC14eHh4Ma+3Afa3n4/v7+Hh4eG1dtV7m2G9V/x1Cd478PDw8E7w8s2t3ZC3en7UjoCHh4d3gNcbVt4OVd0wmzccREg8PDy8MW8rkO1NUO91X9hCw8PDw1vl5S1TeejQy1rz8RQWBjw8PLxVXt7kVG2imgQNeUPAi6nEw8PDO8zrtTflU7BbXkdPwcPDw3sLLw8R8pCimousLRV4eHh4B3h5FVqdjiSYqEYe5ZQFDw8P7wBvsjG/21hQjSeSb+Lh4eGd4PU2nCbxbl4EJ+0C0Xjw8PDwVnmFWjveV9oqxBeWKzw8PLwDvDkjL22r9/aCksKfCg8PD2/A64UC+WZ/Mom9TbKooQEPDw9vlZcEAb1QNS+gR21V13fh4eHhHePl2/yTYrrakJqcL/9PgIeHhzfm9Vqv8hK52siVj6o6Bjw8PLxdXh6k5ttOvQ2w6ls9uoqHh4d3jFdtukq2/PMSudpSkBf0eHh4eLu8rQJ3ErxOGrlejAQPDw/vMK/60/kyME9Wr4v+p8/Fw8PDO8DLmwZyZNKUUB16b8x4eHh4J3i9hWGy5b+7kfbiz4CHh4d3gFcteSePyc/0mrd6pTweHh5ej1cNIHrF7vXUVEOH65IdDw8P7z28ajDRCymqjVO9ScTDw8P7HN5WOJtEGJNCHw8PD++TeXkw0XtWPqFPz+Ph4eEd41UbrSbsvJiu3ltuIMDDw8Nr8ebF6+7n5GqzRQAPDw9vyvsCmz3QdTtjhlcAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script async src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto"></script>


<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '草榴社區-t66y.com ...';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"left","hOffset":0,"vOffset":-20},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"tagMode":false});</script></body>
</html>
